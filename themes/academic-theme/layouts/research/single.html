{{ define "main" }}
<article class="research-single">
    <!-- Hero Banner -->
    <header class="research-hero">
        {{ if .Params.banner_image }}
        <div class="hero-background" style="background-image: url('{{ .Params.banner_image }}');"></div>
        {{ else }}
        <div class="hero-background hero-default"></div>
        {{ end }}
        
        <div class="hero-overlay">
            <div class="container">
                <!-- Breadcrumb -->
                <nav class="breadcrumb">
                    <a href="{{ "/" | relURL }}" class="breadcrumb-link">
                        <i class="fas fa-home"></i>
                        Home
                    </a>
                    <span class="breadcrumb-separator">/</span>
                    <a href="{{ "/research/" | relURL }}" class="breadcrumb-link">Research</a>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-current">{{ .Title }}</span>
                </nav>

                <!-- Hero Content -->
                <div class="hero-content">
                    <h1 class="research-title">{{ .Title }}</h1>
                    
                    {{ if .Params.subtitle }}
                    <p class="research-subtitle">{{ .Params.subtitle }}</p>
                    {{ end }}
                    
                    <!-- Status Badge -->
                    {{ if .Params.status }}
                    <div class="status-badge {{ .Params.status | lower }}">
                        {{ if eq .Params.status "ongoing" }}
                            <i class="fas fa-spinner fa-pulse"></i>
                        {{ else if eq .Params.status "completed" }}
                            <i class="fas fa-check-circle"></i>
                        {{ else if eq .Params.status "published" }}
                            <i class="fas fa-graduation-cap"></i>
                        {{ end }}
                        {{ .Params.status | title }}
                    </div>
                    {{ end }}
                </div>
            </div>
        </div>
    </header>

    <!-- Research Info Card -->
    <div class="container">
        <div class="research-info-card">
            <div class="info-grid">
                <!-- Left Column: Main Meta -->
                <div class="meta-primary">
                    {{ if .Date }}
                    <div class="meta-item">
                        <div class="meta-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="meta-content">
                            <span class="meta-label">Start Date</span>
                            <span class="meta-value">{{ .Date.Format "January 2006" }}</span>
                        </div>
                    </div>
                    {{ end }}
                    
                    {{ if .Params.end_date }}
                    <div class="meta-item">
                        <div class="meta-icon">
                            <i class="fas fa-flag-checkered"></i>
                        </div>
                        <div class="meta-content">
                            <span class="meta-label">End Date</span>
                            <span class="meta-value">{{ .Params.end_date }}</span>
                        </div>
                    </div>
                    {{ end }}
                    
                    {{ if .Params.duration }}
                    <div class="meta-item">
                        <div class="meta-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="meta-content">
                            <span class="meta-label">Duration</span>
                            <span class="meta-value">{{ .Params.duration }}</span>
                        </div>
                    </div>
                    {{ end }}
                </div>

                <!-- Center Column: Team & Collaboration -->
                <div class="meta-secondary">
                    {{ if .Params.authors }}
                    <div class="meta-item">
                        <div class="meta-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="meta-content">
                            <span class="meta-label">Research Team</span>
                            <div class="authors-list">
                                {{ range .Params.authors }}
                                <span class="author">{{ . }}</span>
                                {{ end }}
                            </div>
                        </div>
                    </div>
                    {{ end }}
                    
                    {{ if .Params.institution }}
                    <div class="meta-item">
                        <div class="meta-icon">
                            <i class="fas fa-university"></i>
                        </div>
                        <div class="meta-content">
                            <span class="meta-label">Institution</span>
                            <span class="meta-value">{{ .Params.institution }}</span>
                        </div>
                    </div>
                    {{ end }}
                    
                    {{ if .Params.collaborators }}
                    <div class="meta-item">
                        <div class="meta-icon">
                            <i class="fas fa-handshake"></i>
                        </div>
                        <div class="meta-content">
                            <span class="meta-label">Collaborators</span>
                            <div class="collaborators-list">
                                {{ range .Params.collaborators }}
                                <span class="collaborator">{{ . }}</span>
                                {{ end }}
                            </div>
                        </div>
                    </div>
                    {{ end }}
                </div>

                <!-- Right Column: Funding & Resources -->
                <div class="meta-tertiary">
                    {{ if .Params.funding }}
                    <div class="meta-item">
                        <div class="meta-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="meta-content">
                            <span class="meta-label">Funding</span>
                            <span class="meta-value">{{ .Params.funding }}</span>
                        </div>
                    </div>
                    {{ end }}
                    
                    {{ if .Params.grant_number }}
                    <div class="meta-item">
                        <div class="meta-icon">
                            <i class="fas fa-hashtag"></i>
                        </div>
                        <div class="meta-content">
                            <span class="meta-label">Grant #</span>
                            <span class="meta-value">{{ .Params.grant_number }}</span>
                        </div>
                    </div>
                    {{ end }}

                    {{ if .Params.tags }}
                    <div class="meta-item">
                        <div class="meta-icon">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div class="meta-content">
                            <span class="meta-label">Research Areas</span>
                            <div class="research-tags">
                                {{ range .Params.tags }}
                                <span class="research-tag">{{ . }}</span>
                                {{ end }}
                            </div>
                        </div>
                    </div>
                    {{ end }}
                </div>
            </div>

            <!-- Quick Actions -->
            {{ if or .Params.paper_url .Params.code_url .Params.data_url .Params.demo_url }}
            <div class="quick-actions">
                {{ if .Params.paper_url }}
                <a href="{{ .Params.paper_url }}" class="action-btn paper-btn" target="_blank">
                    <i class="fas fa-file-pdf"></i>
                    <span>Paper</span>
                </a>
                {{ end }}
                
                {{ if .Params.code_url }}
                <a href="{{ .Params.code_url }}" class="action-btn code-btn" target="_blank">
                    <i class="fab fa-github"></i>
                    <span>Code</span>
                </a>
                {{ end }}
                
                {{ if .Params.data_url }}
                <a href="{{ .Params.data_url }}" class="action-btn data-btn" target="_blank">
                    <i class="fas fa-database"></i>
                    <span>Dataset</span>
                </a>
                {{ end }}
                
                {{ if .Params.demo_url }}
                <a href="{{ .Params.demo_url }}" class="action-btn demo-btn" target="_blank">
                    <i class="fas fa-play-circle"></i>
                    <span>Demo</span>
                </a>
                {{ end }}
            </div>
            {{ end }}
        </div>

        <!-- Main Content Area -->
        <div class="research-body">
            <!-- Featured Image -->
            {{ if .Params.featured_image }}
            <div class="featured-image">
                <img src="{{ .Params.featured_image }}" alt="{{ .Title }}" loading="lazy">
                {{ if .Params.image_caption }}
                <figcaption class="image-caption">{{ .Params.image_caption }}</figcaption>
                {{ end }}
            </div>
            {{ end }}

            <!-- Table of Contents -->
            {{ if .TableOfContents }}
            <div class="table-of-contents">
                <div class="toc-header">
                    <h3><i class="fas fa-list"></i> Table of Contents</h3>
                    <button class="toc-toggle" onclick="toggleTOC()">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                </div>
                <div class="toc-content">
                    {{ .TableOfContents }}
                </div>
            </div>
            {{ end }}

            <!-- Research Content -->
            <div class="research-content">
                {{ .Content }}
            </div>

            <!-- Related Publications -->
            {{ if .Params.related_publications }}
            <div class="related-publications">
                <h2><i class="fas fa-scroll"></i> Related Publications</h2>
                <div class="publications-list">
                    {{ range .Params.related_publications }}
                    <div class="publication-item">
                        <div class="pub-content">
                            <h4 class="pub-title">{{ .title }}</h4>
                            <p class="pub-authors">{{ .authors }}</p>
                            <p class="pub-venue">{{ .venue }} ({{ .year }})</p>
                        </div>
                        {{ if .url }}
                        <a href="{{ .url }}" class="pub-link" target="_blank">
                            <i class="fas fa-external-link-alt"></i>
                        </a>
                        {{ end }}
                    </div>
                    {{ end }}
                </div>
            </div>
            {{ end }}

            <!-- Research Timeline -->
            {{ if .Params.timeline }}
            <div class="research-timeline">
                <h2><i class="fas fa-history"></i> Project Timeline</h2>
                <div class="timeline-container">
                    {{ range .Params.timeline }}
                    <div class="timeline-item">
                        <div class="timeline-marker"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">{{ .date }}</div>
                            <h4 class="timeline-title">{{ .title }}</h4>
                            <p class="timeline-description">{{ .description }}</p>
                        </div>
                    </div>
                    {{ end }}
                </div>
            </div>
            {{ end }}
        </div>

        <!-- Navigation -->
        <nav class="research-navigation">
            <div class="nav-container">
                {{ with .PrevInSection }}
                <a class="nav-item prev-research" href="{{ .RelPermalink }}">
                    <div class="nav-direction">
                        <i class="fas fa-chevron-left"></i>
                        <span>Previous Research</span>
                    </div>
                    <div class="nav-title">{{ .Title }}</div>
                    <div class="nav-meta">{{ .Date.Format "January 2006" }}</div>
                </a>
                {{ end }}
                
                <a class="nav-item back-to-research" href="{{ "/research/" | relURL }}">
                    <div class="nav-direction">
                        <i class="fas fa-th-large"></i>
                        <span>All Research</span>
                    </div>
                    <div class="nav-title">Back to Research</div>
                </a>
                
                {{ with .NextInSection }}
                <a class="nav-item next-research" href="{{ .RelPermalink }}">
                    <div class="nav-direction">
                        <span>Next Research</span>
                        <i class="fas fa-chevron-right"></i>
                    </div>
                    <div class="nav-title">{{ .Title }}</div>
                    <div class="nav-meta">{{ .Date.Format "January 2006" }}</div>
                </a>
                {{ end }}
            </div>
        </nav>
    </div>
</article>

<script>
function toggleTOC() {
    const tocContent = document.querySelector('.toc-content');
    const tocToggle = document.querySelector('.toc-toggle i');
    
    if (tocContent.style.display === 'none') {
        tocContent.style.display = 'block';
        tocToggle.className = 'fas fa-chevron-up';
    } else {
        tocContent.style.display = 'none';
        tocToggle.className = 'fas fa-chevron-down';
    }
}

// Smooth scrolling for TOC links
document.addEventListener('DOMContentLoaded', function() {
    const tocLinks = document.querySelectorAll('.toc-content a');
    tocLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});
</script>
{{ end }}